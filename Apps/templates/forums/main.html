{% extends 'base/base.html' %}
{% load static %}
{% block content %}
    <button><a href="{% url 'forums-main' %}">Home</a></button>
    <br>
    <br>
    <legend>Your preference forums:</legend>
    {% for subforums in forums %}
        <button><a href="{% url 'subforum-home' subforums.pk %}">{{ subforums.name.capitalize }}</a></button>
    {% endfor %}

    <legend class="border-bottom m-4">
        Posts
    </legend>

    {% if posts %}
        {% for post in posts %}
            <div class="container">
                <div class="card mb-3">
                    <a href="{% url 'post-detail' post.id %}">
                        <div class="row">
                            <div class="col-8">
                                    <div class="row no-gutters">
                                        <div class="col-3">
                                            <p>Title: {{ post.title }}</p>
                                        </div>
                                        <div class="col-3">
                                            <p>Category: {{ post.sub_forum.category.category.capitalize }}</p>
                                        </div>
                                        <div class="col-3">
                                            <p>Posted by: {{ post.posted_by }}</p>
                                        </div>
                                    </div>
                                    <div class="row no-gutters">
                                        <div class="col">
                                            <p>{{ post.posted_date }}</p>
                                        </div>
                                    </div>
                                    <div class="row no-gutters">
                                        <div class="col">
                                            <p>Description: {{ post.description }}</p>
                                        </div>
                                    </div>
                                </div>
                            <div class="col">
                                <img class="float-right" src="{{ post.media.url }}" alt="user media" style="width:100%; max-width:200px;">
                            </div>
                        </div>
                    </a>
                    <div class="row row-no-gutters">
                        <div class="col">
                            <button class="btn btn-success like-btn" data-id="{{ post.pk }}">Like</button>
                            <p class="likes-count">{{ post.likes }}</p>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
{% endblock content %}
{% block javascript %}
    <script type="text/javascript">
        $(document).ready(function() {
            $(".like-btn").click(function () {
                if ($(this).html() === "Like") {
                    $(this).html("Dislike");

                    let post_pk = $(this).attr("data-id");
                    $.ajax("/forums/", {
                        type: 'GET',
                        data: {post_pk: post_pk}
                    })
                    //dataType: 'json',
                        .done(function () {
                            $(this).html('good!');
                        })
                }
            });
        });

    </script>
{% endblock javascript %}
